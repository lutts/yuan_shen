import sys
import os
import random
from collections import namedtuple
from typing import NamedTuple

sys.path.append(os.path.abspath('../..'))

from analysis_utils.ys_timestamps import Ys_Timestamp, print_timestamps_summary, print_avg_min_max

timestamp_dict = {
    "FTNH6557": ["00:00:00.917", "00:00:02.750",
                 ["00:00:05.935", "00:00:06.468", "00:00:06.985", "00:00:07.485", "00:00:08.035",
                  "00:00:08.485"],
                  "00:00:19.420", "00:00:20.605", "00:00:20.738"
                  ],
    "KQIL4518": ["00:00:01.100", "00:00:02.842",
                 ["00:00:05.627", "00:00:06.127", "00:00:06.643", "00:00:07.143", "00:00:07.660",
                  "00:00:08.160", "00:00:08.677", "00:00:09.160", "00:00:09.660", "00:00:10.110",
                  "00:00:10.627", "00:00:11.110", "00:00:11.627", "00:00:12.212", "00:00:12.678",
                  "00:00:13.162", "00:00:13.662", "00:00:14.145", "00:00:14.645", "00:00:15.145",
                  "00:00:15.645", "00:00:16.162", "00:00:16.662", "00:00:17.162", "00:00:17.662",
                  "00:00:18.178", "00:00:18.678", "00:00:19.195", "00:00:19.695", "00:00:20.197",
                  "00:00:20.697"],
                  "00:00:19.462", "00:00:20.813", "00:00:20.863"
                  ],
    "PGFK6543": ["00:00:00.850", "00:00:00.000",
                 ["00:00:06.035", "00:00:06.518", "00:00:07.018", "00:00:07.568", "00:00:08.068",
                  "00:00:08.585", "00:00:09.085", "00:00:09.602", "00:00:10.102", "00:00:10.602",
                  "00:00:11.102", "00:00:11.602", "00:00:12.103", "00:00:12.570", "00:00:13.087",
                  "00:00:13.703", "00:00:14.103", "00:00:14.603", "00:00:15.103"],
                  "00:00:19.370", "00:00:00.000", "00:00:00.000"
                  ],
    "QYRF3942": ["00:00:00.717", "00:00:00.000",
                 ["00:00:05.493", "00:00:06.010", "00:00:06.493", "00:00:07.010", "00:00:07.510",
                  "00:00:08.060", "00:00:08.560", "00:00:09.060", "00:00:09.577", "00:00:10.077",
                  "00:00:10.577", "00:00:11.077", "00:00:11.577", "00:00:12.078", "00:00:12.478",
                  "00:00:13.045", "00:00:13.562", "00:00:14.062", "00:00:14.562", "00:00:15.078",
                  "00:00:15.578", "00:00:15.995", "00:00:16.495", "00:00:16.995", "00:00:17.495",
                  "00:00:18.045", "00:00:18.562", "00:00:19.062", "00:00:19.562", "00:00:20.078"],
                  "00:00:19.078", "00:00:20.397", "00:00:20.513"],
    "SGFL2663": ["00:00:04.368", "00:00:00.000",
                 ["00:00:13.820", "00:00:14.320", "00:00:14.803", "00:00:15.320", "00:00:15.820",
                  "00:00:16.320", "00:00:16.820", "00:00:17.337", "00:00:17.920", "00:00:18.403",
                  "00:00:18.920", "00:00:19.420", "00:00:19.920", "00:00:20.438", "00:00:20.938",
                  "00:00:21.438", "00:00:21.938", "00:00:22.455", "00:00:22.905", "00:00:23.555",
                  "00:00:24.005"],
                 "00:00:22.905", "00:00:24.088", "00:00:24.155"
                 ],
    "TPKG5556": ["00:00:01.283", "00:00:03.250",
                 ["00:00:06.135", "00:00:06.635", "00:00:07.135", "00:00:07.585", "00:00:08.085",
                  "00:00:08.602", "00:00:09.102", "00:00:09.602", "00:00:10.118", "00:00:10.618",
                  "00:00:11.118", "00:00:11.618", "00:00:12.137"],
                  "00:00:19.653", "00:00:20.955", "00:00:21.022"],
}

class Video_Timestamps(NamedTuple):
    q_anim_start: Ys_Timestamp
    wu_di_end: Ys_Timestamp
    adjust_points: list[Ys_Timestamp]

    bian_kuang_dismiss: Ys_Timestamp
    pao_pao_dismiss: Ys_Timestamp
    hp_restore: Ys_Timestamp


def get_intervals(ys_timestamp_dict: dict[str, Video_Timestamps]):
    intervals_dict = {}
    for filename, t in ys_timestamp_dict.items():
        adjust_intervals = []
        for i in range(1, len(t.adjust_points)):
            adjust_intervals.append(t.adjust_points[i] - t.adjust_points[i-1])

        intervals_dict[filename] = {
            "生命上限调整间隔": adjust_intervals,
            "Q动画开始 - 边框消失": t.bian_kuang_dismiss - t.q_anim_start,
            "Q动画开始 - 无敌结束": t.wu_di_end - t.q_anim_start,
            "Q动画开始 - 泡泡消失": t.pao_pao_dismiss - t.q_anim_start,
            "泡泡消失 - 生命值重置": t.hp_restore - t.pao_pao_dismiss
        }
    
    return intervals_dict

sorted_intervals = print_timestamps_summary(Video_Timestamps, timestamp_dict, get_intervals)